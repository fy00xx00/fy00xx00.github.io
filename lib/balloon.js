!function(t){"use strict";function i(t){this.config=t,this.canvas=t.canvas,this.event=new a,this.context=this.canvas.getContext("2d"),this.init()}function e(t,i,e,s,a){this.x=t,this.y=i,this.r=e,this.color=a,this.ballDisSpeed=s,this.creTime=+new Date}function s(t,i){this.x=t,this.y=i,this.birth=+new Date}function a(){this.handler={}}i.prototype.init=function(){this.canvas.width=this.config.width||500,this.canvas.height=this.config.height||300,this.maxBallNum=this.config.maxBallNum||3,this.ballR=this.config.ballR||25,this.ballDisSpeed=this.config.ballDisSpeed||.2,this.avalibalTime=this.config.avalibalTime||60,this.bulletList=[],this.ballList=[],this.ballNum=0,this.catched=0,this.missed=0,this.clicked=0,this.score=0,this.rule=this.config.rule||{catched:100,missed:-100},this.range={minX:this.ballR,maxX:this.canvas.width-this.ballR,minY:this.ballR,maxY:this.canvas.height-this.ballR};var i,e=["webkit","moz","ms","o"];if(t.requestAnimationFrame)this.animation=t.requestAnimationFrame,this.canacelAnimation=t.cancelAnimationFrame;else for(;i=e.shift();)if(t[i+"RequestAnimationFrame"]){this.animation=t[i+"RequestAnimationFrame"],this.canacelAnimation=t[i+"CancelAnimationFrame"]||t[i+"CancelRequestAnimationFrame"];break}this.initSound(),this.bindEvent(),this.getOffset()},i.prototype.initSound=function(i){var e,s,a,n,o;t.Audio&&(o=new Audio,o.src="./resourse/click.wav",s=new Audio,s.src="./resourse/missed.wav",a=new Audio,a.src="",n=new Audio,n.src="",e=new Audio,e.src="./resourse/catched.wav"),this.sound={catched:e,missed:s,gameover:a,balladd:n,click:o}},i.prototype.random=function(t,i){return t+Math.floor(Math.random()*(i-t+1))},i.prototype.randomPosition=function(){return{x:this.random(this.range.minX,this.range.maxX),y:this.random(this.range.minY,this.range.maxY)}},i.prototype.getOffset=function(){var t;this.canvas.getBoundingClientRect?(t=this.canvas.getBoundingClientRect(),this.offset={x:t.left,y:t.top}):this.offset={x:this.canvas.offsetLeft,y:this.canvas.offsetTop}},i.prototype.bindEvent=function(t){var i=this;this.canvas.addEventListener("click",function(t){var e,a,n,o=!1;for(e=0,a=i.ballList.length;a>e;e++)n=i.ballList[e].getInfo(),Math.abs(t.pageX-i.offset.x-n.x)<n.r&&Math.abs(t.pageY-i.offset.y-n.y)<n.r&&(i.ballList.splice(e,1),e--,a--,i.score+=i.rule.catched,i.playSound("catched"),o=!0,i.trigger("scorechange",{score:i.score}),i.trigger("catched",{x:n.x,y:n.y}));o||(i.bulletList.push(new s(t.pageX-i.offset.x,t.pageY-i.offset.y)),i.playSound("click")),i.trigger("click",{x:t.pageX-i.offset.x,y:t.pageY-i.offset.y})})},i.prototype.drawCircle=function(t,i,e,s){var a=new Path2D;a.arc(t,i,e,0,2*Math.PI),this.context.fillStyle=s,this.context.fill(a)},i.prototype.drawText=function(t,i,e,s,a){this.context.font=s+"px Arial",this.context.fillStyle=a,this.context.fillText(t,i,e)},i.prototype.drawBullet=function(t,i,e,s){e=e||3,this.context.fillStyle=s||"#323232",this.context.beginPath(),this.context.moveTo(t,i),this.context.lineTo(t+e,i+e),this.context.moveTo(t,i),this.context.lineTo(t-e,i+e),this.context.moveTo(t,i),this.context.lineTo(t+e,i-e),this.context.moveTo(t,i),this.context.lineTo(t-e,i-e),this.context.stroke()},i.prototype.clearCanvas=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},i.prototype.playSound=function(t){switch(t){case"click":this.sound.click.play();break;case"catched":this.sound.catched.play();break;case"missed":this.sound.missed.play();break;case"gameover":this.sound.gameover.play();break;case"balladd":this.sound.balladd.play()}},i.prototype.addBall=function(){var t,i;if(0===this.ballList.length)for(t=this.random(1,this.maxBallNum);t--;)i=this.randomPosition(),this.playSound("balladd"),this.trigger("balladd",{x:i.x,y:i.y,r:i.r}),this.ballList.push(new e(i.x,i.y,this.ballR,this.ballDisSpeed,"orange"))},i.prototype.update=function(){var i=this;this.animationId=this.animation.call(t,function(){var t,e,s;for(i.clearCanvas(),i.drawText("剩余时间 : "+i.avalibalTime,i.canvas.width-90,20,14,"#ACACAC"),i.addBall(),t=0,e=i.ballList.length;e>t;t++)s=i.ballList[t].update().getInfo(),i.drawCircle(s.x,s.y,s.r,s.color),s.r<2&&(i.ballList.splice(t,1),t--,e--,i.score+=i.rule.missed,i.trigger("scorechange",{score:i.score}),i.playSound("missed"),i.trigger("missed",{x:s.x,y:s.y}));for(t=0,e=i.bulletList.length;e>t;t++)i.bulletList[t].isLive()?i.drawBullet(i.bulletList[t].x,i.bulletList[t].y):(i.bulletList.splice(t,1),t--,e--);i.update()})},i.prototype.start=function(){var i,e=this;this.animationId=this.animation.call(t,function(){e.update()}),i=setInterval(function(){e.avalibalTime--,e.avalibalTime<30&&(e.maxBallNum=4),e.avalibalTime<10&&(e.maxBallNum=5),e.avalibalTime<=-1&&(e.stop(),clearInterval(i))},1e3)},i.prototype.pouse=function(){this.canacelAnimation.call(t,this.animationId)},i.prototype.stop=function(){this.pouse(),this.clearCanvas(),this.drawText("游戏结束，得分："+this.score+"!",Math.floor(this.canvas.width/2-160),Math.floor(this.canvas.height/2-15),30,"#333"),this.bulletList=[],this.ballList=[],this.ballNum=0,this.catched=0,this.missed=0,this.clicked=0,this.score=0,this.playSound("gameover"),this.trigger("gameover")},i.prototype.on=function(t,i,e){this.event.listen(t,i,e)},i.prototype.removeListener=function(t,i){this.event.unListen(t,i)},i.prototype.trigger=function(t,i,e){this.event.fireEvent(t,i,e)},e.prototype.update=function(){return this.r-=this.ballDisSpeed,this},e.prototype.getInfo=function(){return{x:this.x,y:this.y,r:this.r,color:this.color}},s.prototype.isLive=function(){return!(+new Date-this.birth>500)},a.prototype.listen=function(t,i,e){this.handler[t]||(this.handler[t]=[]),this.handler[t].push(function(t){return function(){var e=Array.prototype.slice.call(arguments);e.push(t),i.apply(this,e)}}(e))},a.prototype.fireEvent=function(t,i,e){var s,a;if(this.handler[t])for(s=0,a=this.handler[t].length;a>s;)this.handler[t][s].call(e,i),s++},a.prototype.unListen=function(t,i){var e,s;if(this.handler[t])if(i)for(e=0,s=this.handler[t].length;s>e;e++)this.handler[t][e]===i&&(this.handler[t].splice(e,1),s--,e--);else this.handler[t]=[]},t.g=new i({canvas:document.getElementById("balloonG"),gameover:function(){}})}(window);