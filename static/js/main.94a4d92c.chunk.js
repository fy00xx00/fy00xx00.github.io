(this.webpackJsonpimgcalculator=this.webpackJsonpimgcalculator||[]).push([[0],{144:function(e,t){},204:function(e,t,n){e.exports=n(392)},209:function(e,t,n){},216:function(e,t){},217:function(e,t){},367:function(e,t){},368:function(e,t){},369:function(e,t){},392:function(e,t,n){"use strict";n.r(t);var a,i,o,r,c=n(0),s=n.n(c),l=n(7),u=n.n(l),d=(n(209),n(210),n(199)),f=n(138),h=n.n(f),v=n(170),m=n(27),p=n(28),b=n(30),y=n(29),k=n(396),g=n(64),x=n(395),j=n(32),C=n(397),O=n(91),N=n.n(O),w=n(394),E=n(41),L=n.n(E),I=function(e){Object(b.a)(n,e);var t=Object(y.a)(n);function n(){var e;Object(m.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={},e}return Object(p.a)(n,[{key:"render",value:function(){var e=this.props.tableData;return s.a.createElement(w.a,{dataSource:e.data,columns:e.columns,pagination:!1})}}]),n}(c.Component),_="LINK",D="ADD",T="DRAG",S="circle",z="triangle",A="rect",K="line",M="link",P=n(406),G=n(405),X=n(404),Y=n(408),R=n(402),W=n(400),B=n(401),H=n(403),U=n(407),q=n(398),F=n(399),J=n(87),Q=n(24),V=n(186),Z=n.n(V),$=n(45),ee=function(e){return function(e){Object(b.a)(n,e);var t=Object(y.a)(n);function n(){var e;Object(m.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).isLinkable=!0,e.stLineList=[],e.edLineList=[],e.linkedNodes=[],e.nodeName="",e}return Object(p.a)(n,[{key:"hasLinkTo",value:function(e){return this===e||this.linkedNodes.includes(e)}},{key:"setName",value:function(e){if(e){this.nodeName=e;var t=this.item&&this.item(1);t&&t.set("text","".concat(this.nodeNo,"-").concat(e))}}},{key:"destory",value:function(){var e=this;this.linkedNodes.forEach((function(t){return t.unlink(e)}))}},{key:"unlink",value:function(e){var t=this.linkedNodes.findIndex((function(t){return e===t}));t>-1&&this.linkedNodes.splice(t,1)}},{key:"unlinkByLine",value:function(e){var t=this.linkedNodes.find((function(t){return t.stLineList.includes(e)||t.edLineList.includes(e)}));t&&(t.unlink(this),this.unlink(t))}},{key:"updateLineList",value:function(){var e=this.getPosition();this.stLineList.forEach((function(t){return t.set({x1:e.x,y1:e.y})})),this.edLineList.forEach((function(t){return t.set({x2:e.x,y2:e.y})}))}}]),n}(e)},te=ee(a=function(e){Object(b.a)(n,e);var t=Object(y.a)(n);function n(e,a){var i;Object(m.a)(this,n);var o=new Q.fabric.Rect(Object($.a)(Object($.a)({width:20,height:20,fill:"#000000",hasControls:!1},e),{},{left:0,top:7})),r=new Q.fabric.Text(String(a),{fontSize:12,left:9,top:0,originX:"center",originY:"center"});return(i=t.call(this,[o,r],{hasControls:!1,left:e.left-10,top:e.top-20-5})).isGroup=!0,i.nodeNo="",i.nodeType=A,i.tWidth=20,i.tHeight=20,i.nodeNo=a,i}return Object(p.a)(n,[{key:"getInstance",value:function(){return this.item(0)}},{key:"getPosition",value:function(){var e=this.getInstance().getCenterPoint();return{x:e.x+this.left+this.tWidth/2,y:e.y+this.top+this.tHeight/2+8}}}]),n}(Q.fabric.Group))||a,ne=ee(i=function(e){Object(b.a)(n,e);var t=Object(y.a)(n);function n(e,a){var i;Object(m.a)(this,n);var o=new Q.fabric.Triangle(Object($.a)(Object($.a)({width:20,height:20,fill:"#000000",hasControls:!1},e),{},{left:0,top:7})),r=new Q.fabric.Text(String(a),{fontSize:12,left:9,top:0,originX:"center",originY:"center"});return(i=t.call(this,[o,r],{hasControls:!1,left:e.left-10,top:e.top-20-5})).nodeNo="",i.nodeType=z,i.tWidth=20,i.tHeight=20,i.nodeNo=a,i}return Object(p.a)(n,[{key:"getInstance",value:function(){return this.item(0)}},{key:"getPosition",value:function(){var e=this.getInstance().getCenterPoint();return{x:e.x+this.left+this.tWidth/2,y:e.y+this.top+this.tHeight/2+8}}}]),n}(Q.fabric.Group))||i,ae=ee(o=function(e){Object(b.a)(n,e);var t=Object(y.a)(n);function n(e,a){var i;Object(m.a)(this,n);var o=new Q.fabric.Circle(Object($.a)(Object($.a)({radius:10,fill:"#000000",hasControls:!1},e),{},{left:0,top:8})),r=new Q.fabric.Text(String(a),{fontSize:12,left:10,top:0,originX:"center",originY:"center"});return(i=t.call(this,[o,r],{hasControls:!1,left:e.left-10,top:e.top-20-5})).isGroup=!0,i.nodeNo="",i.nodeType=S,i.radius=10,i.nodeNo=a,i}return Object(p.a)(n,[{key:"getInstance",value:function(){return this.item(0)}},{key:"getPosition",value:function(){var e=this.getInstance().getCenterPoint();return{x:e.x+this.left+this.radius,y:e.y+this.top+this.radius+6}}}]),n}(Q.fabric.Group))||o,ie=ee(r=function(e){Object(b.a)(n,e);var t=Object(y.a)(n);function n(e,a){var i;Object(m.a)(this,n);var o=e[2]-e[0],r=e[3]-e[1],c=Math.min(e[0],e[2]),s=Math.min(e[1],e[3]),l=new Q.fabric.Line([0,0,o,r],{fill:"#000000",stroke:"#000000",strokeWidth:2,selectable:!1,evented:!1,hasControls:!1}),u=new Q.fabric.Text(String(a),{fontSize:12,left:o/2+12,top:Math.abs(r)/2-12,originX:"center",originY:"center"});return(i=t.call(this,[l,u],{hasControls:!1,left:c,top:s})).isGroup=!0,i.nodeNo="",i.nodeType=K,i.nodeNo=a,i}return Object(p.a)(n,[{key:"getInstance",value:function(){return this.item(0)}},{key:"getPosition",value:function(){var e=this.getInstance().getCenterPoint();return{x:e.x+this.left+1+this.width/2,y:e.y+this.top+this.height/2}}}]),n}(Q.fabric.Group))||r,oe=Q.fabric.Canvas,re=function(e){Object(b.a)(n,e);var t=Object(y.a)(n);function n(e){var a;Object(m.a)(this,n),(a=t.call(this)).currentKey="",a.mod="",a.payload=null,a.linkStart=null,a.canvas=null,a.nodeNo=1,a.mouseDown=function(e){var t=Object(J.a)(a).canvas,n=e.e;if(!0===n.shiftKey)return a.mod=T,t.selection=!1,void(a.payload={x:n.clientX,y:n.clientY});var i=t.findTarget(n);return a.currentKey===M?(a.mod=_,void(i&&!a.linkStart&&(a.linkStart=i))):a.currentKey&&!i?(a.mod=D,void(a.currentKey===K&&(a.payload={x:n.layerX,y:n.layerY},t.selection=!1,t.setCursor("move")))):(a.mod="",void(a.payload=null))},a.mouseUp=function(e){var t=Object(J.a)(a).canvas,n=e.e;if(t.selection=!0,t.setCursor("default"),a.mod===T)return a.mod="";if(a.mod===D)return a.add(n.layerX,n.layerY);if(a.mod===_){var i=t.findTarget(n);a.linkStart&&i&&a.linkStart!==i&&(a.link(a.linkStart,i),a.linkStart=null)}},a.mouseMove=function(e){if(a.mod===T){var t=e.e,n=a.canvas.viewportTransform;n[4]+=t.clientX-a.payload.x,n[5]+=t.clientY-a.payload.y,a.canvas.setViewportTransform(n),a.update(),a.payload.x=t.clientX,a.payload.y=t.clientY}},a.objectMove=function(e){var t=e.target;t&&t.updateLineList&&t.updateLineList(),a.canvas.renderAll()};var i=a.canvas=new oe(e);return i.on("mouse:down",a.mouseDown),i.on("mouse:move",a.mouseMove),i.on("mouse:up",a.mouseUp),i.on("object:moving",a.objectMove),a}return Object(p.a)(n,[{key:"setCurrentKey",value:function(e){this.currentKey=e}},{key:"add",value:function(e,t){var n=this,a=this.canvas.viewportTransform;switch(e-=a[4],t-=a[5],this.currentKey){case S:var i=new ae({top:t,left:e},this.nodeNo++);i.on("mousedblclick",(function(){return n.emit("itemDbClick",i)})),this.canvas.add(i);break;case z:var o=new ne({top:t,left:e},this.nodeNo++);o.on("mousedblclick",(function(){return n.emit("itemDbClick",o)})),this.canvas.add(o);break;case A:var r=new te({top:t,left:e},this.nodeNo++);r.on("mousedblclick",(function(){return n.emit("itemDbClick",r)})),this.canvas.add(r);break;case K:var c=this.payload,s=c.x,l=c.y;if(s-=a[4],l-=a[5],Math.abs(e-s)<10&&Math.abs(t-l)<10)break;var u=new ie([s,l,e,t],this.nodeNo++);u.on("mousedblclick",(function(){return n.emit("itemDbClick",u)})),this.canvas.add(u)}}},{key:"link",value:function(e,t){if(!e.hasLinkTo(t)){var n=e.getPosition(),a=t.getPosition(),i=new Q.fabric.Line([n.x,n.y,a.x,a.y],{fill:"#000000",stroke:"#000000",strokeWidth:1,selectable:!1,strokeDashArray:[1,2],evented:!1,hasControls:!1});this.canvas.add(i),e.stLineList.push(i),t.edLineList.push(i),e.linkedNodes.push(t),t.linkedNodes.push(e)}}},{key:"addImg",value:function(e){var t=this;Q.fabric.Image.fromURL(e,(function(e){e.scale(t.canvas.height/e.height),t.canvas.backgroundImage=e,t.update()}))}},{key:"undo",value:function(){var e=this.canvas.getObjects();if(e.length){var t=e.pop();t.isLinkable?t.destory():e.filter((function(e){return e.isLinkable})).forEach((function(e){return e.unlinkByLine(t)})),this.canvas.remove(t),this.update()}}},{key:"clearAll",value:function(){this.canvas.clear()}},{key:"getNodes",value:function(){return this.canvas.getObjects().filter((function(e){return e.isLinkable}))}},{key:"update",value:function(){this.canvas.requestRenderAll()}}]),n}(Z.a),ce=function(e){Object(b.a)(n,e);var t=Object(y.a)(n);function n(){var e;return Object(m.a)(this,n),(e=t.call(this)).state={key:"",tableData:{},visible:!1},e.controlor=null,e.handleClick=function(t){var n=t.key;e.setState({key:n}),e.controlor.setCurrentKey(n)},e.resizeCanvas=function(){var t=e.refs.canvasCon,n=e.refs.canvas;n.width=t.offsetWidth,n.height=t.offsetHeight-6},e.undo=function(){e.controlor.undo()},e.clearAll=function(){k.a.confirm({title:"Confirm",icon:s.a.createElement(P.a,null),content:"\u786e\u8ba4\u6e05\u7a7a\u6240\u6709\u5143\u7d20\u5417\uff1f",okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",onOk:function(){return e.controlor.clearAll()}})},e.itemDbClick=function(){var t=Object(v.a)(h.a.mark((function t(n){var a;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.isLinkable&&(a=prompt("\u8bf7\u8f93\u5165\u540d\u79f0"),n.setName(a),e.controlor.update());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.compute=function(){var t=e.controlor.getNodes(),n=[{title:"",dataIndex:"index",key:"index",_text:"",render:function(e,t){return t.index}}],a=[];t.forEach((function(i){var o=s.a.createElement("span",null,s.a.createElement("span",null,i.nodeNo),"\xa0",e.getIcon(i.nodeType),"\xa0",i.nodeName||""),r="".concat(i.nodeNo,"-").concat(i.nodeType).concat(i.nodeName?"-".concat(i.nodeName):"");n.push({title:o,dataIndex:i.nodeNo,key:i.nodeNo,_text:r});var c={index:o,_text:r,_valList:[]};t.forEach((function(e){var t=i.hasLinkTo(e)?1:0;c._valList.push(t),c[e.nodeNo]=t})),a.push(c)})),e.setState({tableData:{columns:n,data:a},visible:!0})},e.drawerClose=function(){e.setState({visible:!1})},e.imgChange=function(t){var n=t.file,a=new FileReader;a.onload=function(t){e.controlor.addImg(t.target.result)},a.readAsDataURL(n)},e.exportExcel=function(){var t=e.state.tableData,n=t.columns.map((function(e){return e._text})),a=t.data.map((function(e){return[e._text].concat(Object(d.a)(e._valList))}));a.unshift(n);var i=N.a.utils.aoa_to_sheet(a),o=N.a.utils.book_new();N.a.utils.book_append_sheet(o,i,"Bookmarks"),N.a.writeFile(o,"matrix.xlsx")},e}return Object(p.a)(n,[{key:"componentDidMount",value:function(){var e=document.querySelector("#canvas");this.resizeCanvas(),this.controlor=new re(e),this.controlor.on("itemDbClick",this.itemDbClick)}},{key:"getIcon",value:function(e){switch(e){case z:return s.a.createElement(G.a,null);case S:return s.a.createElement(X.a,null);case A:return s.a.createElement(Y.a,null);case K:return s.a.createElement(R.a,null);default:return s.a.createElement("i",null)}}},{key:"render",value:function(){var e=this.state,t=e.visible,n=e.tableData;return s.a.createElement("div",{className:L.a.wrapper},s.a.createElement("div",null,s.a.createElement(g.a,{onClick:this.handleClick,selectedKeys:[this.state.key],mode:"horizontal"},s.a.createElement(g.a.Item,{key:z,icon:this.getIcon(z)}),s.a.createElement(g.a.Item,{key:S,icon:this.getIcon(S)}),s.a.createElement(g.a.Item,{key:A,icon:this.getIcon(A)}),s.a.createElement(g.a.Item,{key:K,icon:this.getIcon(K)}),s.a.createElement(g.a.Item,{key:M,icon:s.a.createElement(W.a,null)}),s.a.createElement(x.a,{accept:"image/*",className:L.a.inline,showUploadList:!1,customRequest:this.imgChange},s.a.createElement(j.a,{size:"small",className:"".concat(L.a.btn," ").concat(L.a.fst),icon:s.a.createElement(B.a,null)},"\u80cc\u666f\u56fe")),s.a.createElement(j.a,{size:"small",icon:s.a.createElement(H.a,null),className:L.a.btn,onClick:this.undo},"\u64a4\u9500"),s.a.createElement(j.a,{size:"small",type:"danger",icon:s.a.createElement(U.a,null),className:L.a.btn,onClick:this.clearAll},"\u6e05\u7a7a\u6240\u6709"),s.a.createElement(j.a,{size:"small",type:"primary",className:L.a.btn,icon:s.a.createElement(q.a,null),onClick:this.compute},"\u8ba1\u7b97"))),s.a.createElement("div",{className:L.a.content,ref:"canvasCon"},s.a.createElement("canvas",{ref:"canvas",id:"canvas"})),s.a.createElement(C.a,{title:"\u8ba1\u7b97\u7ed3\u679c",placement:"right",closable:!0,onClose:this.drawerClose,visible:t,width:1100},s.a.createElement(j.a,{size:"small",type:"primary",style:{marginBottom:"10px"},icon:s.a.createElement(F.a,null),onClick:this.exportExcel},"\u5bfc\u51fa"),s.a.createElement(I,{tableData:n})))}}]),n}(c.Component);u.a.render(s.a.createElement(ce,null),document.getElementById("root"))},41:function(e,t,n){e.exports={wrapper:"style_wrapper__1LMdT",content:"style_content__3DQlG",btn:"style_btn__1tvSy",fst:"style_fst__2vnGs",inline:"style_inline__1y95Q"}}},[[204,1,2]]]);
//# sourceMappingURL=main.94a4d92c.chunk.js.map