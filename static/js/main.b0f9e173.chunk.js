(this.webpackJsonpimgcalculator=this.webpackJsonpimgcalculator||[]).push([[0],{142:function(e,t){},200:function(e,t,n){e.exports=n(387)},205:function(e,t,n){},211:function(e,t){},212:function(e,t){},362:function(e,t){},363:function(e,t){},364:function(e,t){},387:function(e,t,n){"use strict";n.r(t);var a,i,o,r,s=n(0),c=n.n(s),l=n(7),u=n.n(l),h=(n(205),n(206),n(195)),d=n(27),f=n(28),v=n(32),m=n(31),y=n(391),p=n(64),b=n(390),k=n(30),g=n(392),x=n(90),E=n.n(x),j=n(389),w=n(41),L=n.n(w),O=function(e){Object(v.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(d.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={},e}return Object(f.a)(n,[{key:"render",value:function(){var e=this.props.tableData;return c.a.createElement(j.a,{dataSource:e.data,columns:e.columns,pagination:!1})}}]),n}(s.Component),N="LINK",C="ADD",I="DRAG",_="circle",T="triangle",S="rect",D="line",A="link",M=n(401),z=n(400),K=n(399),P=n(403),G=n(397),R=n(395),X=n(396),Y=n(398),W=n(402),q=n(393),B=n(394),H=n(24),U=n(45),F=function(e){return function(e){Object(v.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(d.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).isLinkable=!0,e.stLineList=[],e.edLineList=[],e.linkedNodes=[],e.name="",e}return Object(f.a)(n,[{key:"hasLinkTo",value:function(e){return this===e||this.linkedNodes.includes(e)}},{key:"setName",value:function(e){this.name=e}},{key:"destory",value:function(){var e=this;this.linkedNodes.forEach((function(t){return t.unlink(e)}))}},{key:"unlink",value:function(e){var t=this.linkedNodes.findIndex((function(t){return e===t}));t>-1&&this.linkedNodes.splice(t,1)}},{key:"unlinkByLine",value:function(e){var t=this.linkedNodes.find((function(t){return t.stLineList.includes(e)||t.edLineList.includes(e)}));t&&(t.unlink(this),this.unlink(t))}},{key:"updateLineList",value:function(){var e=this.getPosition();this.stLineList.forEach((function(t){return t.set({x1:e.x,y1:e.y})})),this.edLineList.forEach((function(t){return t.set({x2:e.x,y2:e.y})}))}}]),n}(e)},J=F(a=function(e){Object(v.a)(n,e);var t=Object(m.a)(n);function n(e,a){var i;Object(d.a)(this,n);var o=new H.fabric.Rect(Object(U.a)(Object(U.a)({width:20,height:20,fill:"#000000",hasControls:!1},e),{},{left:0,top:7})),r=new H.fabric.Text(String(a),{fontSize:12,left:9,top:0,originX:"center",originY:"center"});return(i=t.call(this,[o,r],{hasControls:!1,left:e.left-10,top:e.top-20-5})).isGroup=!0,i.nodeNo="",i.nodeType=S,i.tWidth=20,i.tHeight=20,i.nodeNo=a,i}return Object(f.a)(n,[{key:"getInstance",value:function(){return this.item(0)}},{key:"getPosition",value:function(){var e=this.getInstance().getCenterPoint();return{x:e.x+this.left+this.tWidth/2,y:e.y+this.top+this.tHeight/2+8}}}]),n}(H.fabric.Group))||a,Q=F(i=function(e){Object(v.a)(n,e);var t=Object(m.a)(n);function n(e,a){var i;Object(d.a)(this,n);var o=new H.fabric.Triangle(Object(U.a)(Object(U.a)({width:20,height:20,fill:"#000000",hasControls:!1},e),{},{left:0,top:7})),r=new H.fabric.Text(String(a),{fontSize:12,left:9,top:0,originX:"center",originY:"center"});return(i=t.call(this,[o,r],{hasControls:!1,left:e.left-10,top:e.top-20-5})).nodeNo="",i.nodeType=T,i.tWidth=20,i.tHeight=20,i.nodeNo=a,i}return Object(f.a)(n,[{key:"getInstance",value:function(){return this.item(0)}},{key:"getPosition",value:function(){var e=this.getInstance().getCenterPoint();return{x:e.x+this.left+this.tWidth/2,y:e.y+this.top+this.tHeight/2+8}}}]),n}(H.fabric.Group))||i,V=F(o=function(e){Object(v.a)(n,e);var t=Object(m.a)(n);function n(e,a){var i;Object(d.a)(this,n);var o=new H.fabric.Circle(Object(U.a)(Object(U.a)({radius:10,fill:"#000000",hasControls:!1},e),{},{left:0,top:8})),r=new H.fabric.Text(String(a),{fontSize:12,left:10,top:0,originX:"center",originY:"center"});return(i=t.call(this,[o,r],{hasControls:!1,left:e.left-10,top:e.top-20-5})).isGroup=!0,i.nodeNo="",i.nodeType=_,i.radius=10,i.nodeNo=a,i}return Object(f.a)(n,[{key:"getInstance",value:function(){return this.item(0)}},{key:"getPosition",value:function(){var e=this.getInstance().getCenterPoint();return console.log(e),{x:e.x+this.left+this.radius,y:e.y+this.top+this.radius+6}}}]),n}(H.fabric.Group))||o,Z=F(r=function(e){Object(v.a)(n,e);var t=Object(m.a)(n);function n(e,a){var i;Object(d.a)(this,n);var o=e[2]-e[0],r=e[3]-e[1],s=Math.min(e[0],e[2]),c=Math.min(e[1],e[3]),l=new H.fabric.Line([0,0,o,r],{fill:"#000000",stroke:"#000000",strokeWidth:2,selectable:!1,evented:!1,hasControls:!1}),u=new H.fabric.Text(String(a),{fontSize:12,left:o/2+12,top:Math.abs(r)/2-12,originX:"center",originY:"center"});return console.log(s,c,o,r,Math.max(Math.abs(o)/2,20),Math.abs(r)/2-12),(i=t.call(this,[l,u],{hasControls:!1,left:s,top:c})).isGroup=!0,i.nodeNo="",i.nodeType=D,i.nodeNo=a,i}return Object(f.a)(n,[{key:"getInstance",value:function(){return this.item(0)}},{key:"getPosition",value:function(){var e=this.getInstance().getCenterPoint();return console.log(e),{x:e.x+this.left+1+this.width/2,y:e.y+this.top+this.height/2}}}]),n}(H.fabric.Group))||r,$=H.fabric.Canvas,ee=function(){function e(t){var n=this;Object(d.a)(this,e),this.currentKey="",this.mod="",this.payload=null,this.linkStart=null,this.canvas=null,this.nodeNo=1,this.mouseDown=function(e){var t=n.canvas,a=e.e;if(!0===a.shiftKey)return n.mod=I,t.selection=!1,void(n.payload={x:a.clientX,y:a.clientY});var i=t.findTarget(a);return n.currentKey===A?(n.mod=N,void(i&&!n.linkStart&&(n.linkStart=i))):n.currentKey&&!i?(n.mod=C,void(n.currentKey===D&&(n.payload={x:a.layerX,y:a.layerY},t.selection=!1,t.setCursor("move")))):(n.mod="",void(n.payload=null))},this.mouseUp=function(e){var t=n.canvas,a=e.e;if(t.selection=!0,t.setCursor("default"),n.mod===I)return n.mod="";if(n.mod===C)return n.add(a.layerX,a.layerY);if(n.mod===N){var i=t.findTarget(a);n.linkStart&&i&&n.linkStart!==i&&(n.link(n.linkStart,i),n.linkStart=null)}},this.mouseMove=function(e){if(n.mod===I){var t=e.e,a=n.canvas.viewportTransform;a[4]+=t.clientX-n.payload.x,a[5]+=t.clientY-n.payload.y,n.canvas.setViewportTransform(a),n.canvas.requestRenderAll(),n.payload.x=t.clientX,n.payload.y=t.clientY}},this.objectMove=function(e){var t=e.target;t&&t.updateLineList&&t.updateLineList(),n.canvas.renderAll()};var a=this.canvas=new $(t);a.on("mouse:down",this.mouseDown),a.on("mouse:move",this.mouseMove),a.on("mouse:up",this.mouseUp),a.on("object:moving",this.objectMove)}return Object(f.a)(e,[{key:"setCurrentKey",value:function(e){this.currentKey=e}},{key:"add",value:function(e,t){var n=this.canvas.viewportTransform;switch(e-=n[4],t-=n[5],this.currentKey){case _:var a=new V({top:t,left:e},this.nodeNo++);this.canvas.add(a);break;case T:var i=new Q({top:t,left:e},this.nodeNo++);this.canvas.add(i);break;case S:var o=new J({top:t,left:e},this.nodeNo++);this.canvas.add(o);break;case D:var r=this.payload,s=r.x,c=r.y;if(s-=n[4],c-=n[5],Math.abs(e-s)<10&&Math.abs(t-c)<10)break;var l=new Z([s,c,e,t],this.nodeNo++);this.canvas.add(l)}}},{key:"link",value:function(e,t){if(!e.hasLinkTo(t)){var n=e.getPosition(),a=t.getPosition(),i=new H.fabric.Line([n.x,n.y,a.x,a.y],{fill:"#000000",stroke:"#000000",strokeWidth:1,selectable:!1,strokeDashArray:[1,2],evented:!1,hasControls:!1});this.canvas.add(i),e.stLineList.push(i),t.edLineList.push(i),e.linkedNodes.push(t),t.linkedNodes.push(e)}}},{key:"addImg",value:function(e){var t=this;H.fabric.Image.fromURL(e,(function(e){e.scale(t.canvas.height/e.height),t.canvas.backgroundImage=e,t.canvas.requestRenderAll()}))}},{key:"undo",value:function(){var e=this.canvas.getObjects();if(e.length){var t=e.pop();t.isLinkable?t.destory():e.filter((function(e){return e.isLinkable})).forEach((function(e){return e.unlinkByLine(t)})),this.canvas.remove(t),this.canvas.requestRenderAll()}}},{key:"clearAll",value:function(){this.canvas.clear()}},{key:"getNodes",value:function(){return this.canvas.getObjects().filter((function(e){return e.isLinkable}))}}]),e}(),te=function(e){Object(v.a)(n,e);var t=Object(m.a)(n);function n(){var e;return Object(d.a)(this,n),(e=t.call(this)).state={key:"",tableData:{},visible:!1},e.controlor=null,e.handleClick=function(t){var n=t.key;e.setState({key:n}),e.controlor.setCurrentKey(n)},e.resizeCanvas=function(){var t=e.refs.canvasCon,n=e.refs.canvas;n.width=t.offsetWidth,n.height=t.offsetHeight-6},e.undo=function(){e.controlor.undo()},e.clearAll=function(){y.a.confirm({title:"Confirm",icon:c.a.createElement(M.a,null),content:"\u786e\u8ba4\u6e05\u7a7a\u6240\u6709\u5143\u7d20\u5417\uff1f",okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",onOk:function(){return e.controlor.clearAll()}})},e.compute=function(){var t=e.controlor.getNodes(),n=[{title:"",dataIndex:"index",key:"index",_text:"",render:function(e,t){return t.index}}],a=[];t.forEach((function(i){var o=c.a.createElement("span",null,c.a.createElement("span",null,i.nodeNo),"\xa0",e.getIcon(i.nodeType)),r="".concat(i.nodeNo,"-").concat(i.nodeType).concat(i.nodeName?"-".concat(i.nodeName):"");n.push({title:o,dataIndex:i.nodeNo,key:i.nodeNo,_text:r});var s={index:o,_text:r,_valList:[]};t.forEach((function(e){var t=i.hasLinkTo(e)?1:0;s._valList.push(t),s[e.nodeNo]=t})),a.push(s)})),e.setState({tableData:{columns:n,data:a},visible:!0})},e.drawerClose=function(){e.setState({visible:!1})},e.imgChange=function(t){var n=t.file,a=new FileReader;a.onload=function(t){e.controlor.addImg(t.target.result)},a.readAsDataURL(n)},e.exportExcel=function(){var t=e.state.tableData,n=t.columns.map((function(e){return e._text})),a=t.data.map((function(e){return[e._text].concat(Object(h.a)(e._valList))}));a.unshift(n);var i=E.a.utils.aoa_to_sheet(a),o=E.a.utils.book_new();E.a.utils.book_append_sheet(o,i,"Bookmarks"),E.a.writeFile(o,"matrix.xlsx")},e}return Object(f.a)(n,[{key:"componentDidMount",value:function(){var e=document.querySelector("#canvas");this.resizeCanvas(),this.controlor=new ee(e)}},{key:"getIcon",value:function(e){switch(e){case T:return c.a.createElement(z.a,null);case _:return c.a.createElement(K.a,null);case S:return c.a.createElement(P.a,null);case D:return c.a.createElement(G.a,null);default:return c.a.createElement("i",null)}}},{key:"render",value:function(){var e=this.state,t=e.visible,n=e.tableData;return c.a.createElement("div",{className:L.a.wrapper},c.a.createElement("div",null,c.a.createElement(p.a,{onClick:this.handleClick,selectedKeys:[this.state.key],mode:"horizontal"},c.a.createElement(p.a.Item,{key:T,icon:this.getIcon(T)}),c.a.createElement(p.a.Item,{key:_,icon:this.getIcon(_)}),c.a.createElement(p.a.Item,{key:S,icon:this.getIcon(S)}),c.a.createElement(p.a.Item,{key:D,icon:this.getIcon(D)}),c.a.createElement(p.a.Item,{key:A,icon:c.a.createElement(R.a,null)}),c.a.createElement(b.a,{accept:"image/*",className:L.a.inline,showUploadList:!1,customRequest:this.imgChange},c.a.createElement(k.a,{size:"small",className:"".concat(L.a.btn," ").concat(L.a.fst),icon:c.a.createElement(X.a,null)},"\u80cc\u666f\u56fe")),c.a.createElement(k.a,{size:"small",icon:c.a.createElement(Y.a,null),className:L.a.btn,onClick:this.undo},"\u64a4\u9500"),c.a.createElement(k.a,{size:"small",type:"danger",icon:c.a.createElement(W.a,null),className:L.a.btn,onClick:this.clearAll},"\u6e05\u7a7a\u6240\u6709"),c.a.createElement(k.a,{size:"small",type:"primary",className:L.a.btn,icon:c.a.createElement(q.a,null),onClick:this.compute},"\u8ba1\u7b97"))),c.a.createElement("div",{className:L.a.content,ref:"canvasCon"},c.a.createElement("canvas",{ref:"canvas",id:"canvas"})),c.a.createElement(g.a,{title:"\u8ba1\u7b97\u7ed3\u679c",placement:"right",closable:!0,onClose:this.drawerClose,visible:t,width:1100},c.a.createElement(k.a,{size:"small",type:"primary",style:{marginBottom:"10px"},icon:c.a.createElement(B.a,null),onClick:this.exportExcel},"\u5bfc\u51fa"),c.a.createElement(O,{tableData:n})))}}]),n}(s.Component);u.a.render(c.a.createElement(te,null),document.getElementById("root"))},41:function(e,t,n){e.exports={wrapper:"style_wrapper__1LMdT",content:"style_content__3DQlG",btn:"style_btn__1tvSy",fst:"style_fst__2vnGs",inline:"style_inline__1y95Q"}}},[[200,1,2]]]);
//# sourceMappingURL=main.b0f9e173.chunk.js.map