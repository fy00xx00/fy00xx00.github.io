!function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=i(1),r=n(o),c=function(){function t(e,i){var n=this;a(this,t),this.g=new r.default(e,i);var s=this.ws=new WebSocket("ws://123.206.80.123:5120");s.onopen=function(){},s.onerror=function(){n.ws=null},s.onmessage=function(t){console.log(t.data);var e=JSON.parse(t.data);switch(e.code){case"NO_ROOM":alert("没有可分配房间了!");break;case"ROOM_EXIST":alert("房间已存在");break;case"CREATE_SUCCESS":n.g.next=1,document.title=e.id,alert("创建完成等待加入,房间号:"+e.id);break;case"ROOM_NOT_EXIT":alert("房间不存在");break;case"ROOM_NO_PLACE":alert("房间已满");break;case"JOIN_SELF":alert("不能加入自己");break;case"JOIN_SUCCESS":n.g.reset(),n.g.next=2;break;case"PLAYER_DISCON":n.g.reset(),n.g.canAdd=!1,alert("另一位玩家离开 :( ");break;case"START":alert("玩家加入,游戏开始"),1===n.g.next?n.g.canAdd=!0:n.g.canAdd=!1,n.g.start();break;case"GO_NEXT":n.g.addPoint(e.data.point.column,e.data.point.row,e.data.value),n.g._nextStep();break;case"WIN":alert((n.g.next==e.role?"你":"对方")+"赢了,重新开始"),n.g.reset(),1===n.g.next?n.g.canAdd=!0:n.g.canAdd=!1}},this.g.addCallBack=function(t){s.send(JSON.stringify({code:"NEXT",point:t,value:this.next}))}}return s(t,[{key:"createRoom",value:function(){this.ws&&this.ws.send(JSON.stringify({code:"CREATE"}))}},{key:"joinRoom",value:function(){this.ws&&this.ws.send(JSON.stringify({code:"JOIN",id:prompt("输入房间号")}))}}]),t}();window.wzq=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=i(2),r=n(o),c=i(3),h=n(c),l=i(4),d=n(l),u=function(){function t(e,i){var n=this;a(this,t),this.canvas=e,this.context=e.getContext("2d"),this._global=i,this.initScreenRatio(),this.GRID_LINE_HEIGHT=40*this.baseRatio,this.POINT_RADIUS=20*this.baseRatio,this.GRID_DX=this.GRID_LINE_HEIGHT,this.GRID_DY=this.GRID_LINE_HEIGHT,this.DRAW_GRID_DX=0,this.DRAW_GRID_DY=0,this.BASE_X=0,this.BASE_Y=0,this.lastUpdate=0,this.fps=0,this.adjRatio=1,this.points={},this.canAdd=!0,this.next=1,this.draging=!1,this.animation=new d.default(function(t){n.update.call(n,t)}),this.control=new r.default(this.canvas,this._global,this.baseRatio),this.painer=new h.default(this.context,this.canvas.width,this.canvas.height),this.initControl()}return s(t,[{key:"initScreenRatio",value:function(){var t=window.devicePixelRatio||1,e=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1,i=t/e;this.canvas.style.borderWidth=0,this.canvas.style.width=this.canvas.offsetWidth,this.canvas.style.height=this.canvas.offsetHeight,this.canvas.width=i*this.canvas.offsetWidth,this.canvas.height=i*this.canvas.offsetHeight,this.baseRatio=i}},{key:"setBaseLine",value:function(t,e){this.BASE_X-=parseInt((this.GRID_DX+t)/this.GRID_LINE_HEIGHT),this.BASE_Y-=parseInt((this.GRID_DY+e)/this.GRID_LINE_HEIGHT),this.GRID_DX=this.DRAW_GRID_DX,this.GRID_DY=this.DRAW_GRID_DY}},{key:"setGridCord",value:function(t,e){this.DRAW_GRID_DX=(this.GRID_DX+t)%this.GRID_LINE_HEIGHT,this.DRAW_GRID_DY=(this.GRID_DY+e)%this.GRID_LINE_HEIGHT}},{key:"getPoint",value:function(t,e){var i=0,n=0,a=t-this.GRID_DX,s=e-this.GRID_DY,o=~~(this.GRID_LINE_HEIGHT/2),r=~~(this.GRID_LINE_HEIGHT/2),c=a%this.GRID_LINE_HEIGHT,h=s%this.GRID_LINE_HEIGHT;if(c<0){if(c<-o)return!1;i=this.BASE_X}else if(c<o)i=this.BASE_X+Math.floor(a/this.GRID_LINE_HEIGHT);else{if(!(c>r))return!1;i=this.BASE_X+Math.ceil(a/this.GRID_LINE_HEIGHT)}if(h<0){if(h<-o)return!1;n=this.BASE_Y}else if(h<o)n=this.BASE_Y+Math.floor(s/this.GRID_LINE_HEIGHT);else{if(!(h>r))return!1;n=this.BASE_Y+Math.ceil(s/this.GRID_LINE_HEIGHT)}return{column:i,row:n}}},{key:"getPointPosition",value:function(t,e){return{x:(t-this.BASE_X)*this.GRID_LINE_HEIGHT+this.GRID_DX,y:(e-this.BASE_Y)*this.GRID_LINE_HEIGHT+this.GRID_DY}}},{key:"addPoint",value:function(t,e,i){this.points[t]&&this.points[t][e]||(this.points[t]||(this.points[t]={}),this.points[t][e]=i)}},{key:"reset",value:function(){this.points={}}},{key:"_nextStep",value:function(t){this.canAdd=!0,t&&(this.next=t)}},{key:"initControl",value:function(){var t=this;this.control.on("click",function(e){var i=void 0;t.canAdd&&(i=t.getPoint(e.x,e.y),i&&(t.addPoint(i.column,i.row,t.next),t.canAdd=!1,"function"==typeof t.addCallBack&&t.addCallBack.call(t,i,t._nextStep.bind(t))))}),this.control.on("drag",function(e){t.draging=!0,t.dragDx=e.dx,t.dragDy=e.dy,t.setGridCord(e.dx,e.dy)}),this.control.on("dragend",function(e){t.draging=!1,t.setBaseLine(e.dx,e.dy)})}},{key:"update",value:function(t){var e=void 0,i=void 0,n=void 0;if(this.painer.clear(),t.time-this.lastUpdate>1e3&&(this.fps=t.fps,this.lastUpdate=+new Date),this.painer.drawGrid(this.DRAW_GRID_DX,this.DRAW_GRID_DY,this.GRID_LINE_HEIGHT,this.GRID_LINE_HEIGHT,this.canvas.width,this.canvas.height),this.draging)for(e in this.points)for(i in this.points[e])n=this.getPointPosition(e,i),n.x+=this.dragDx,n.y+=this.dragDy,n.x>0&&n.x<this.canvas.width&&n.y>0&&n.y<this.canvas.height&&this.painer.drawPoint(n.x,n.y,this.POINT_RADIUS,this.points[e][i]);else for(e in this.points)for(i in this.points[e])n=this.getPointPosition(e,i),n.x>0&&n.x<this.canvas.width&&n.y>0&&n.y<this.canvas.height&&this.painer.drawPoint(n.x,n.y,this.POINT_RADIUS,this.points[e][i]);this.painer.drawText("fps:"+this.fps,20,20)}},{key:"start",value:function(){this.animation.start()}},{key:"stop",value:function(){this.animation.stop()}}]),t}();e.default=u},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function(){function t(e,n,a){i(this,t),this.global=n,this.canvas=e,this.screenRatio=a,this.basePos=this.canvas.getBoundingClientRect(),this.handler={},this.drag={start:!1,moving:!1,x:0,y:0},this.initElementEvent()}return n(t,[{key:"on",value:function(t,e){return this.handler[t]?void this.handler[t].push(e):void(this.handler[t]=[e])}},{key:"trigger",value:function(t,e,i){this.handler[t]&&this.handler[t].forEach(function(t,n){t.call(e,i)})}},{key:"initElementEvent",value:function(){var t=this;this.canvas&&(this.canvas.addEventListener("mousedown",function(e){t.drag.x=(e.pageX-t.basePos.left)*t.screenRatio,t.drag.y=(e.pageY-t.basePos.top)*t.screenRatio,t.drag.start=!0,t.drag.moving=!1,e.stopPropagation(),e.preventDefault()}),this.global.addEventListener("mousemove",function(e){var i=(e.pageX-t.basePos.left)*t.screenRatio,n=(e.pageY-t.basePos.top)*t.screenRatio,a=i-t.drag.x,s=n-t.drag.y;t.drag.start&&(t.drag.moving=!0,t.trigger("drag",t.canvas,{x:i,y:n,dx:a,dy:s,type:"drag"})),e.stopPropagation(),e.preventDefault()}),this.canvas.addEventListener("mouseup",function(e){var i=(e.pageX-t.basePos.left)*t.screenRatio,n=(e.pageY-t.basePos.top)*t.screenRatio;t.drag.moving?t.trigger("dragend",t.canvas,{x:i,y:n,dx:i-t.drag.x,dy:n-t.drag.y,type:"dragend"}):t.trigger("click",t.canvas,{x:i,y:n,type:"click"}),t.drag.start=!1,t.drag.moving=!1,e.stopPropagation(),e.preventDefault()}),this.canvas.addEventListener("mouseout",function(e){var i=(e.pageX-t.basePos.left)*t.screenRatio,n=(e.pageY-t.basePos.top)*t.screenRatio;t.drag.moving&&(t.trigger("dragend",t.canvas,{x:i,y:n,dx:i-t.drag.x,dy:n-t.drag.y,type:"dragend"}),t.drag.start=!1,t.drag.moving=!1)})),this.global&&(this.global.addEventListener("keyup",function(e){t.trigger("keyup",t.canvas,{keyCode:e.keyCode,key:String.fromCharCode(e.keyCode).toUpperCase()}),e.stopPropagation(),e.preventDefault()}),this.global.addEventListener("keydown",function(e){t.trigger("keydown",t.canvas,{keyCode:e.keyCode,key:String.fromCharCode(e.keyCode).toUpperCase()}),e.stopPropagation(),e.preventDefault()}),this.global.addEventListener("keypress",function(e){t.trigger("keypress",t.canvas,{keyCode:e.keyCode,key:String.fromCharCode(e.keyCode).toUpperCase()}),e.stopPropagation(),e.preventDefault()}))}}]),t}();e.default=a},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function(){function t(e,n,a){i(this,t),this.context=e,this.width=n,this.height=a}return n(t,[{key:"clear",value:function(){this.context.clearRect(0,0,this.width,this.height)}},{key:"drawText",value:function(t,e,i,n,a,s){this.context.save(),this.font=n||"12px Microsoft Yahei",this.context.fillStyle=a||"red",this.context.fillText(t,e,i,s),this.context.restore()}},{key:"drawGrid",value:function(t,e,i,n,a,s,o,r){var c=this.context;for(c.save(),c.lineWidth=o||1,c.strokeStyle=r||"rgba(0,0,0,1)";t<a;)c.beginPath(),c.moveTo(t,0),c.lineTo(t,s),c.stroke(),t+=i;for(;e<s;)c.beginPath(),c.moveTo(0,e),c.lineTo(a,e),c.stroke(),e+=n;c.restore()}},{key:"drawPoint",value:function(t,e,i,n){var a=this.context,s=Math.PI;a.save(),a.beginPath(),a.fillStyle=1===n?"rgba(0,0,0,1)":"rgba(255,255,255,1)",a.arc(t,e,i,0,2*s),a.fill(),a.restore()}}]),t}();e.default=a},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function(){function t(e){i(this,t),this.updater=e,this.animationId=null,this.lastUpdate=0,this.requestAnimation=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||this.polyfillAnimation(),this.cancelAnimation=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelAnimationFrame||this.polyfillCavaelAnimation()}return n(t,[{key:"polyfillAnimation",value:function(){return function(t){return setTimeout(function(){t.call()},60)}}},{key:"polyfillCavaelAnimation",value:function(){var t=this;return function(){clearTimeout(t.animationId)}}},{key:"start",value:function(){var t=this,e=this.updater,i=function i(){var n=+new Date;e({time:n,fps:Math.ceil(1e3/(n-t.lastUpdate))}),t.lastUpdate=+new Date,t.animationId=t.requestAnimation.call(window,i)};this.animationId=this.requestAnimation.call(window,i)}},{key:"stop",value:function(){this.cancelAnimation.call(window,this.animationId)}}]),t}();e.default=a}]);